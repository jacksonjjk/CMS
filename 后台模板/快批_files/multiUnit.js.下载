/**
 * WEB端 - 多单位换算插件
 * @ maoqy
 */
;(function($) {	
	$.fn.multiUnit = function (options) {			
			return this.each(function () {
				var defaults = {
					Money_Scale : $("#Money_Scale").val(),//小数位
					 base_unit : $(".base_unit"),//第一单位
					 second_unit : $(".second_unit"),//第二单位
					 third_unit : $(".third_unit"),//第三单位
					 base_unit01 : $(".base_unit01"),
					 second_unit01 : $(".second_unit01"),
					 unit_ratio1 : $(".unit_ratio1"),//第一单位比例
					 unit_ratio2 : $(".unit_ratio2"),//第二单位比例
					 base_sale_price : $(".base_sale_price"),//第一批发价
					 second_sale_price : $(".second_sale_price"),//第二批发价
					 third_sale_price : $(".third_sale_price"),//第三批发价
					 /** 开启多价格 **/
					 base_retail_price : $(".base_retail_price"),//第一零售价
					 second_retail_price : $(".second_retail_price"),//第二零售价
					 third_retail_price : $(".third_retail_price"),//第三零售价
				}; 
				var opts = $.extend(defaults, options); 
					
					//自动获取单位值
					opts.base_unit.on('input propertychange',function(){
						if ( $(this).val() !== '' ){
							opts.base_unit01.html($(this).val());
						}
					});
					opts.second_unit.on('input propertychange',function(){
						if ( $(this).val() !== '' ){
							opts.second_unit01.html($(this).val());
						}
					});
					var val1,val2,val3, val4;
					
					/*比例失焦*/
					opts.unit_ratio1.on('blur',function(){
						//自动计算批发价
						if ( opts.second_sale_price.val() === '' ){
						if (opts.base_sale_price.val() && opts.unit_ratio1.val()){
							 val1 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val(), Money_Scale);
							opts.second_sale_price.val( val1 );
						}
						}
						//自动计算零售价
						if ( opts.second_retail_price.val() === '' ){
						if (opts.base_retail_price.val() && opts.unit_ratio1.val()){
							val3 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val(), Money_Scale);
							opts.second_retail_price.val( val3 );
						}
						}
					});
					opts.unit_ratio2.on('blur',function(){
						if ( opts.third_sale_price.val() === '' ){
						if (opts.second_sale_price.val() && opts.unit_ratio2.val()){
							val2 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
							opts.third_sale_price.val( val2 );
						}
						}
						if ( opts.third_retail_price.val() === '' ){
						if (opts.second_retail_price.val() && opts.unit_ratio2.val()){	
							val4 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
							opts.third_retail_price.val( val4 );
						}
						}
					});
					
					/*第一批发价，零售价失焦*/
					opts.base_sale_price.on('blur',function(){
						if ( opts.second_sale_price.val() === '' ){
						if (opts.base_sale_price.val() && opts.unit_ratio1.val()){
							val1 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val(), Money_Scale);
							opts.second_sale_price.val( val1 );
						}
						}
						if ( opts.third_sale_price.val() === '' ){
						if (opts.second_sale_price.val() && opts.unit_ratio2.val()){
							val2 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
							opts.third_sale_price.val( val2 );
						}
						}
					});
					opts.base_retail_price.on('blur',function(){
						if ( opts.second_retail_price.val() === '' ){
						if (opts.base_retail_price.val() && opts.unit_ratio1.val()){
							val3 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val(), Money_Scale);
							opts.second_retail_price.val( val3 );
						}
						}
						if ( opts.third_retail_price.val() === '' ){
						if (opts.second_retail_price.val() && opts.unit_ratio2.val()){
							val4 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
							opts.third_retail_price.val( val4 );
						}
						}
					});
					

					opts.second_sale_price.on('focus',function(){
						if ( opts.second_sale_price.val() === '' ){
							if (opts.base_sale_price.val() && opts.unit_ratio1.val()){
								val1 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val(), Money_Scale);
								opts.second_sale_price.val( val1 );
							}
						}
					});
					opts.third_sale_price.on('focus',function(){
						if ( opts.third_sale_price.val() === '' ){
							if (opts.second_sale_price.val() && opts.unit_ratio2.val()){
								val2 = formatMoney( opts.base_sale_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
								opts.third_sale_price.val( val2 );
							}
						}
					});
					opts.second_retail_price.on('focus',function(){
						if ( opts.second_retail_price.val() === '' ){
							if (opts.base_retail_price.val() && opts.unit_ratio1.val()){
								val3 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val(), Money_Scale);
								opts.second_retail_price.val( val3 );
							}
						}
					});
					opts.third_retail_price.on('focus',function(){
						if ( opts.third_retail_price.val() === '' ){
							if (opts.second_retail_price.val() && opts.unit_ratio2.val()){
								val4 = formatMoney( opts.base_retail_price.val() * opts.unit_ratio1.val() * opts.unit_ratio2.val(), Money_Scale);
								opts.third_retail_price.val( val4 );
							}
						}
					});
					
		});
	}
})($);